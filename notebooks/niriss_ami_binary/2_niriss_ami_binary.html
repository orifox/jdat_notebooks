
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NIRISS AMI calibration of binary point source AB Dor and calibrator HD37093 &#8212; STScI JDAT Notebooks</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/main.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Analyzing the JWST Pipeline products of HAT-P-1b observations with NIRISS/SOSS" href="../soss-transit-spectroscopy/HAT-P-1b-PART3-data-analysis.html" />
    <link rel="prev" title="NIRISS AMI simulation of binary point source AB Dor and calibrator HD37093" href="1_niriss_ami_binary.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-D46G4HKJY3"></script>
<script>
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){ dataLayer.push(arguments); }
                    gtag('js', new Date());
                    gtag('config', 'G-D46G4HKJY3');
                </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/stsci_logo2.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">STScI JDAT Notebooks</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../intro.html">
   James Webb Space Telescope Data Analysis Tool Notebooks
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Cross-Instrument
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../asdf_example/asdf_example.html">
   Example of Converting a FITS File to ASDF
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../background_estimation_imaging/Imaging%20Sky%20Background%20Estimation.html">
   Complex 2D Background
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../composite_model_fitting/specfit_demo_3.html">
   Draft: Advanced Composite spectral model fitting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../NIRSpec_MAST_Query/NIRSpec_MAST_Query.html">
   MAST Query
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../specviz_notebookGUI_interaction/specviz_notebook_gui_interaction_redshift.html">
   Specviz Simple Demo
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  MIRI
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../MRS_Mstar_analysis/JWST_Mstar_dataAnalysis_runpipeline.html">
   MIRI MRS Spectroscopy of a Late M Star 1 - Running the Pipeline
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../MRS_Mstar_analysis/JWST_Mstar_dataAnalysis_analysis.html">
   Data Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../MIRI_IFU_YSOs_in_the_LMC/isha_nayak_ysos_in_the_lmc.html">
   JWST Data Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../MIRI_LRS_spectral_extraction/miri_lrs_spectral_extraction.html">
   LRS Extraction
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  NIRCam
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../aperture_photometry/NIRCam_Aperture_Photometry_Example.html">
   Point Source Aperture Photometry
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../NIRCam_photometry/NIRCam%20multiband%20photometry.html">
   NIRCam Multiband Photometry
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../psf_photometry/NIRCam_PSF_Photometry_Example.html">
   PSF Photometry
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../NIRCam_PSF-matched_photometry/NIRCam_PSF_matched_multiband_photometry.html">
   NIRCam PSF-matched multiband photometry
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../preimaging/preimaging_02_calwebb.html">
   Preimaging - Calwebb
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../preimaging/preimaging_03_association.html">
   Creating simulated images of the JWST astrometric calibration field in the LMC
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  NIRISS
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../NIRISS_WFSS_postpipeline/00.%20Optimal%20extraction.html">
   Part 0: Optimal Extraction of NIRISS WFSS Spectrum
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../NIRISS_WFSS_postpipeline/01.%20Combine%20and%20normalize%201D%20spectra.html">
   Part 1: Combine One-Dimensional NIRISS WFSS Spectra
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../NIRISS_WFSS_postpipeline/02.%20Cross%20correlation%20template.html">
   Part 2: Cross Correlation to Determine Redshift of NIRISS WFSS Spectra
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../NIRISS_WFSS_postpipeline/03.%20Spatially%20resolved%20emission%20line%20map.html">
   Part 3: Spatially Resolved Emission Line Map of NIRISS WFSS Spectra
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="1_niriss_ami_binary.html">
   NIRISS AMI simulation of binary point source AB Dor and calibrator HD37093
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   AMI Binary Star Notebook 2
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../soss-transit-spectroscopy/HAT-P-1b-PART3-data-analysis.html">
   SOSS Transient Spectroscopy
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  NIRSpec
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../ifu_optimal/ifu_optimal.html">
   IFU Optimal Extraction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../optimal_extraction_dynamic/Spectral%20Extraction.html">
   NIRSpec MOS Optimal Spectral Extraction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../mos-spectroscopy/MOSspec_sv06_revised.html">
   MOS Spectroscopy of Extragalactic Field
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../transit_spectroscopy_notebook/Exoplanet_Transmission_Spectra_JWST.html">
   Extracting an Exoplanet Transmission Spectrum from NIRSpec BOTS Time Series Observations
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/notebooks/niriss_ami_binary/2_niriss_ami_binary.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/spacetelescope/jdat_notebooks/"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/spacetelescope/jdat_notebooks//issues/new?title=Issue%20on%20page%20%2Fnotebooks/niriss_ami_binary/2_niriss_ami_binary.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        
        
        <button type="button" class="btn btn-secondary topbarbtn"
            onclick="initThebeSBT()" title="Launch Thebe" data-toggle="tooltip" data-placement="left"><i
                class="fas fa-play"></i><span style="margin-left: .4em;">Live Code</span></button>
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#imports">
   Imports
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#loading-data">
   Loading data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#examine-the-input-raw-files">
   Examine the input raw files
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#define-output-directory-and-non-default-reference-files-directory">
   Define output directory and non-default reference files directory
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#run-detector1-and-image2-pipelines">
   Run Detector1 and Image2 pipelines
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#examine-the-output-files">
   Examine the output files
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#rate-and-rateints-files">
     rate and rateints files
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cal-and-calints-files">
     cal and calints files
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#display-calibrated-data">
   Display calibrated data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#run-implaneia-to-reduce-calibrated-images-to-fringe-observables">
   Run ImPlaneIA to reduce calibrated images to fringe observables
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#define-functions">
     Define functions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-implaneia">
     Run ImPlaneIA
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#examine-the-output-products">
     Examine the output products
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#information-about-observables-calculated-from-the-1st-integration">
     Information about observables calculated from the 1st integration
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#oifits-files-for-the-target-and-calibrator">
     OIFITS files for the target and calibrator
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#calibrate-the-closure-phases-and-fringe-amplitudes-of-target-with-the-closure-phases-and-fringe-amplitudes-of-the-calibrator">
     Calibrate the closure phases and fringe amplitudes of target with the closure phases and fringe amplitudes of the calibrator.
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#aditional-resources">
   Aditional Resources
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#about-this-notebook">
   About this notebook
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>NIRISS AMI calibration of binary point source AB Dor and calibrator HD37093</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#imports">
   Imports
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#loading-data">
   Loading data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#examine-the-input-raw-files">
   Examine the input raw files
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#define-output-directory-and-non-default-reference-files-directory">
   Define output directory and non-default reference files directory
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#run-detector1-and-image2-pipelines">
   Run Detector1 and Image2 pipelines
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#examine-the-output-files">
   Examine the output files
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#rate-and-rateints-files">
     rate and rateints files
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cal-and-calints-files">
     cal and calints files
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#display-calibrated-data">
   Display calibrated data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#run-implaneia-to-reduce-calibrated-images-to-fringe-observables">
   Run ImPlaneIA to reduce calibrated images to fringe observables
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#define-functions">
     Define functions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-implaneia">
     Run ImPlaneIA
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#examine-the-output-products">
     Examine the output products
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#information-about-observables-calculated-from-the-1st-integration">
     Information about observables calculated from the 1st integration
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#oifits-files-for-the-target-and-calibrator">
     OIFITS files for the target and calibrator
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#calibrate-the-closure-phases-and-fringe-amplitudes-of-target-with-the-closure-phases-and-fringe-amplitudes-of-the-calibrator">
     Calibrate the closure phases and fringe amplitudes of target with the closure phases and fringe amplitudes of the calibrator.
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#aditional-resources">
   Aditional Resources
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#about-this-notebook">
   About this notebook
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <p><a id="top"></a></p>
<div class="tex2jax_ignore mathjax_ignore section" id="niriss-ami-calibration-of-binary-point-source-ab-dor-and-calibrator-hd37093">
<h1>NIRISS AMI calibration of binary point source AB Dor and calibrator HD37093<a class="headerlink" href="#niriss-ami-calibration-of-binary-point-source-ab-dor-and-calibrator-hd37093" title="Permalink to this headline">¶</a></h1>
<hr class="docutils" />
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This notebook runs JWST pipeline on Aperture Masking Interferometry(AMI) data of binary point source AB Dor and calibrator HD37093 simulated with Mirage.</p>
<p>Steps:</p>
<p>[1] Run Detector1 pipeline on all _uncal.fits files to create _rate.fits and _rateints.fits files.</p>
<p>[2] Run Image2 pipeline on all _rate.fits files to create _cal.fits and on _rateints.fits files to
create _calints.fits files.</p>
<p>[3] Run ImPlaneIA (<a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2015ApJ...798...68G/abstract">Greenbaum, A. et al. 2015</a>) to extract observables in oifits format.</p>
<p><em>Developer Note:</em>
Create the conda environment needed to run this notebook by issuing the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">create</span> <span class="o">-</span><span class="n">n</span> <span class="o">&lt;</span><span class="n">myenv</span><span class="o">&gt;</span> <span class="n">python</span><span class="o">=</span><span class="mf">3.6</span>
</pre></div>
</div>
<p>Activate the environment and then open the notebook.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">activate</span> <span class="o">&lt;</span><span class="n">myenv</span><span class="o">&gt;</span>
<span class="n">jupyter</span> <span class="n">notebook</span>
</pre></div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Permalink to this headline">¶</a></h2>
<p>Describe the libraries we’re using here. If there’s something unusual, explain what the library is, and why we need it.</p>
<ul class="simple">
<li><p><em>numpy</em> to handle array functions</p></li>
<li><p><em><a class="reference external" href="http://astropy.io">astropy.io</a> fits</em> for accessing FITS files</p></li>
<li><p><em>matplotlib.pyplot</em> for plotting data</p></li>
<li><p><em>zipfile</em> for accessing zip file</p></li>
<li><p><em>urllib.request</em> to access URL</p></li>
<li><p><em>jwst.pipeline Detector1Pipeline, Image2Pipeline</em> for calibrating raw data</p></li>
<li><p>ImplaneIA to extract interferometric obssrvables from calibrated data</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">u</span>
<span class="kn">import</span> <span class="nn">zipfile</span>
<span class="kn">import</span> <span class="nn">urllib.request</span>

<span class="kn">from</span> <span class="nn">jwst.pipeline</span> <span class="kn">import</span> <span class="n">Detector1Pipeline</span><span class="p">,</span> <span class="n">Image2Pipeline</span>

<span class="kn">from</span> <span class="nn">nrm_analysis.misctools</span> <span class="kn">import</span> <span class="n">utils</span>
<span class="kn">import</span> <span class="nn">nrm_analysis</span>
<span class="kn">from</span> <span class="nn">nrm_analysis.fringefitting.LG_Model</span> <span class="kn">import</span> <span class="n">NRM_Model</span>
<span class="kn">from</span> <span class="nn">nrm_analysis</span> <span class="kn">import</span> <span class="n">nrm_core</span><span class="p">,</span> <span class="n">InstrumentData</span>
<span class="kn">from</span> <span class="nn">nrm_analysis</span> <span class="kn">import</span> <span class="n">find_affine2d_parameters</span> <span class="k">as</span> <span class="n">FAP</span>
<span class="kn">from</span> <span class="nn">nrm_analysis.misctools.implane2oifits</span> <span class="kn">import</span> <span class="n">calibrate_oifits</span>

<span class="kn">from</span> <span class="nn">nrm_analysis.misctools.utils</span> <span class="kn">import</span> <span class="n">Affine2d</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="nn">Input In [1],</span> in <span class="ni">&lt;cell line: 16&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> <span class="kn">import</span> <span class="nn">urllib.request</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span> <span class="kn">from</span> <span class="nn">jwst.pipeline</span> <span class="kn">import</span> <span class="n">Detector1Pipeline</span><span class="p">,</span> <span class="n">Image2Pipeline</span>
<span class="ne">---&gt; </span><span class="mi">16</span> <span class="kn">from</span> <span class="nn">nrm_analysis.misctools</span> <span class="kn">import</span> <span class="n">utils</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span> <span class="kn">import</span> <span class="nn">nrm_analysis</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span> <span class="kn">from</span> <span class="nn">nrm_analysis.fringefitting.LG_Model</span> <span class="kn">import</span> <span class="n">NRM_Model</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;nrm_analysis&#39;
</pre></div>
</div>
</div>
</div>
<p><em>Developer Note:</em>
Plese follow the instructions on <a class="reference external" href="https://webbpsf.readthedocs.io/en/latest/installation.html">https://webbpsf.readthedocs.io/en/latest/installation.html</a> to download WebbPSF data
files and create WEBBPSF_PATH location.</p>
<div class="alert alert-info">
<p><strong>Note:</strong> DO NOT UPGRADE PYSIAF AS INSTRUCTED BY THE ABOVE WARNING.
Pysiaf 0.10.0 uses PRD release PRDOPSSOC-031. APT 2020.4.1 that was used to create the xml and pointing files used in this notebook uses PRDOPSSOC-030. The mismatch bewtween these two PRD versions causes incorrect placement of PSF. The version of Mirage used in this notebook comes with pysiaf 0.10.0. It was downgraded to 0.9.0 using the file requirements.txt to resolve the placement issue. Using Pysiaf 0.10.0 will cause incorrect placement of the PSF.</p>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nrm_analysis</span><span class="o">.</span><span class="n">__path__</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">pwd</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="loading-data">
<h2>Loading data<a class="headerlink" href="#loading-data" title="Permalink to this headline">¶</a></h2>
<p>Download simulated data created by 1_niriss_ami_binary.ipynb and reference files needed to calibrate data without bad pixels.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">boxlink</span> <span class="o">=</span> <span class="s1">&#39;https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/niriss_ami_binary/niriss_ami_binary2.zip&#39;</span>
<span class="n">boxfile</span> <span class="o">=</span> <span class="s1">&#39;./niriss_ami_binary2.zip&#39;</span>

<span class="c1"># Download zip file</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">boxfile</span><span class="p">):</span>
    <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">boxlink</span><span class="p">,</span> <span class="n">boxfile</span><span class="p">)</span>

    <span class="n">zf</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">boxfile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">zf</span><span class="o">.</span><span class="n">extractall</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define directory that has existing Mirage simulations</span>
<span class="n">currentdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="n">mirage_sim_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">currentdir</span><span class="p">,</span> <span class="s1">&#39;mirage_sim_data/&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">mirage_sim_dir</span><span class="p">)</span>
<span class="n">datafiles</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">mirage_sim_dir</span> <span class="o">+</span> <span class="s1">&#39;jw*uncal.fits&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">datafiles</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="examine-the-input-raw-files">
<h2>Examine the input raw files<a class="headerlink" href="#examine-the-input-raw-files" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">datafiles</span><span class="p">):</span>
    <span class="n">file</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">im</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">im</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;AB-Dor&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;HD37093&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">11</span><span class="p">],</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="define-output-directory-and-non-default-reference-files-directory">
<h2>Define output directory and non-default reference files directory<a class="headerlink" href="#define-output-directory-and-non-default-reference-files-directory" title="Permalink to this headline">¶</a></h2>
<p>Note that we will not use the cfgfiles but update the steps and override reference files using the .run() method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define output directory to save pipeline output products and default configuration files.</span>
<span class="n">odir</span> <span class="o">=</span> <span class="s1">&#39;./pipeline_calibrated_data/&#39;</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">odir</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">odir</span><span class="p">)</span>

<span class="c1"># Define path to non-default reference files.</span>
<span class="c1"># We are using these files to calibrate data that is simulated without bad pixels.</span>
<span class="n">refdir</span> <span class="o">=</span> <span class="s1">&#39;./ref_files_non_default/&#39;</span>

<span class="c1"># os.environ[&#39;CRDS_PATH&#39;]=&#39;$HOME/crds_cache&#39;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CRDS_SERVER_URL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;https://jwst-crds.stsci.edu&#39;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CRDS_CONTEXT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;jwst_0641.pmap&#39;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="run-detector1-and-image2-pipelines">
<h2>Run Detector1 and Image2 pipelines<a class="headerlink" href="#run-detector1-and-image2-pipelines" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">datafiles</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">mirage_sim_dir</span> <span class="o">+</span> <span class="s1">&#39;jw*uncal.fits&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">datafiles</span><span class="p">)</span>
<span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">datafiles</span><span class="p">:</span>
<span class="c1"># Run Detector1, Image 2 pipelines</span>
    <span class="n">result1</span> <span class="o">=</span> <span class="n">Detector1Pipeline</span><span class="p">()</span>
    <span class="n">superbiasfile</span> <span class="o">=</span> <span class="n">refdir</span> <span class="o">+</span> <span class="s1">&#39;jwst_niriss_superbias_sim.fits&#39;</span>
    <span class="n">darkfile</span> <span class="o">=</span> <span class="n">refdir</span> <span class="o">+</span> <span class="s1">&#39;jwst_niriss_dark_sub80_sim.fits&#39;</span>
    <span class="n">result1</span><span class="o">.</span><span class="n">superbias</span><span class="o">.</span><span class="n">override_superbias</span> <span class="o">=</span> <span class="n">superbiasfile</span>
    <span class="n">result1</span><span class="o">.</span><span class="n">dark_current</span><span class="o">.</span><span class="n">override_dark</span> <span class="o">=</span> <span class="n">darkfile</span>
    <span class="n">result1</span><span class="o">.</span><span class="n">ipc</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">result1</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">result1</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">=</span> <span class="n">odir</span>
    <span class="n">result1</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="n">df_rate</span> <span class="o">=</span> <span class="n">odir</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;uncal&#39;</span><span class="p">,</span> <span class="s1">&#39;rate&#39;</span><span class="p">))</span>
    <span class="n">flatfieldfile</span> <span class="o">=</span> <span class="n">refdir</span> <span class="o">+</span> <span class="s2">&quot;jwst_niriss_flat_general.fits&quot;</span>
    <span class="n">result2</span> <span class="o">=</span> <span class="n">Image2Pipeline</span><span class="p">()</span>
    <span class="n">result2</span><span class="o">.</span><span class="n">flat_field</span><span class="o">.</span><span class="n">override_flat</span> <span class="o">=</span> <span class="n">flatfieldfile</span>
    <span class="n">result2</span><span class="o">.</span><span class="n">photom</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">result2</span><span class="o">.</span><span class="n">resample</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">result2</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">result2</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">=</span> <span class="n">odir</span>
    <span class="n">result2</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">df_rate</span><span class="p">)</span>

    <span class="n">df_rateints</span> <span class="o">=</span> <span class="n">odir</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;uncal&#39;</span><span class="p">,</span> <span class="s1">&#39;rateints&#39;</span><span class="p">))</span>
    <span class="n">result3</span> <span class="o">=</span> <span class="n">Image2Pipeline</span><span class="p">()</span>
    <span class="n">result3</span><span class="o">.</span><span class="n">flat_field</span><span class="o">.</span><span class="n">override_flat</span> <span class="o">=</span> <span class="n">flatfieldfile</span>
    <span class="n">result3</span><span class="o">.</span><span class="n">photom</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">result3</span><span class="o">.</span><span class="n">resample</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">result3</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">result3</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">=</span> <span class="n">odir</span>
    <span class="n">result3</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">df_rateints</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="examine-the-output-files">
<h2>Examine the output files<a class="headerlink" href="#examine-the-output-files" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ratefiles</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">odir</span> <span class="o">+</span> <span class="s1">&#39;jw*rate.fits&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ratefiles</span><span class="p">)</span>
<span class="n">rateintsfiles</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">odir</span> <span class="o">+</span> <span class="s1">&#39;jw*rateints.fits&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rateintsfiles</span><span class="p">)</span>
<span class="n">calfiles</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">odir</span> <span class="o">+</span> <span class="s1">&#39;jw*cal.fits&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">calfiles</span><span class="p">)</span>
<span class="n">calintsfiles</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">odir</span> <span class="o">+</span> <span class="s1">&#39;jw*calints.fits&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">calintsfiles</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="rate-and-rateints-files">
<h3>rate and rateints files<a class="headerlink" href="#rate-and-rateints-files" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">rateintf</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rateintsfiles</span><span class="p">):</span>
    <span class="n">file</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">rateintf</span><span class="p">)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ratef</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ratefiles</span><span class="p">):</span>
    <span class="n">file</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">ratef</span><span class="p">)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="cal-and-calints-files">
<h3>cal and calints files<a class="headerlink" href="#cal-and-calints-files" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">calintf</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">calintsfiles</span><span class="p">):</span>
    <span class="n">file</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">calintf</span><span class="p">)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">calf</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">calfiles</span><span class="p">):</span>
    <span class="n">file</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">calf</span><span class="p">)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="display-calibrated-data">
<h2>Display calibrated data<a class="headerlink" href="#display-calibrated-data" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">calfiles</span><span class="p">:</span>
    <span class="n">file</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
<span class="c1"># print(data[0].shape, data[1].shape)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;AB-Dor 2D calibrated file&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;HD37093 2D calibrated file&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="run-implaneia-to-reduce-calibrated-images-to-fringe-observables">
<h2>Run ImPlaneIA to reduce calibrated images to fringe observables<a class="headerlink" href="#run-implaneia-to-reduce-calibrated-images-to-fringe-observables" title="Permalink to this headline">¶</a></h2>
<div class="section" id="define-functions">
<h3>Define functions<a class="headerlink" href="#define-functions" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">160</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">examine_observables</span><span class="p">(</span><span class="n">ff</span><span class="p">,</span> <span class="n">trim</span><span class="o">=</span><span class="mi">36</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; input: FringeFitter instance after fringes are fit &quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Examine_observables, standard deviations &amp; variances of *independent* CP&#39;s and CAs:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   Closure phase mean </span><span class="si">{:+.4f}</span><span class="s2">  std dev </span><span class="si">{:.2e}</span><span class="s2">  var </span><span class="si">{:.2e}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ff</span><span class="o">.</span><span class="n">nrm</span><span class="o">.</span><span class="n">redundant_cps</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>\
              <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">cp_var</span><span class="p">(</span><span class="n">ff</span><span class="o">.</span><span class="n">nrm</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">ff</span><span class="o">.</span><span class="n">nrm</span><span class="o">.</span><span class="n">redundant_cps</span><span class="p">)),</span> <span class="n">utils</span><span class="o">.</span><span class="n">cp_var</span><span class="p">(</span><span class="n">ff</span><span class="o">.</span><span class="n">nrm</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">ff</span><span class="o">.</span><span class="n">nrm</span><span class="o">.</span><span class="n">redundant_cps</span><span class="p">)))</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   Closure amp   mean </span><span class="si">{:+.4f}</span><span class="s2">  std dev </span><span class="si">{:.2e}</span><span class="s2">  var </span><span class="si">{:.2e}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ff</span><span class="o">.</span><span class="n">nrm</span><span class="o">.</span><span class="n">redundant_cas</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>\
              <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">cp_var</span><span class="p">(</span><span class="n">ff</span><span class="o">.</span><span class="n">nrm</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">ff</span><span class="o">.</span><span class="n">nrm</span><span class="o">.</span><span class="n">redundant_cas</span><span class="p">)),</span> <span class="n">utils</span><span class="o">.</span><span class="n">cp_var</span><span class="p">(</span><span class="n">ff</span><span class="o">.</span><span class="n">nrm</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">ff</span><span class="o">.</span><span class="n">nrm</span><span class="o">.</span><span class="n">redundant_cas</span><span class="p">)))</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    Fringe amp   mean </span><span class="si">{:+.4f}</span><span class="s2">  std dev </span><span class="si">{:.2e}</span><span class="s2">  var </span><span class="si">{:.2e}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ff</span><span class="o">.</span><span class="n">nrm</span><span class="o">.</span><span class="n">fringeamp</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
                                                                             <span class="n">ff</span><span class="o">.</span><span class="n">nrm</span><span class="o">.</span><span class="n">fringeamp</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span>
                                                                             <span class="n">ff</span><span class="o">.</span><span class="n">nrm</span><span class="o">.</span><span class="n">fringeamp</span><span class="o">.</span><span class="n">var</span><span class="p">()))</span>

    <span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">formatter</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;float&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{:+.1e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)},</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Normalized residuals central 6 pixels&quot;</span><span class="p">)</span>
    <span class="n">tlo</span><span class="p">,</span> <span class="n">thi</span> <span class="o">=</span> <span class="p">(</span><span class="n">ff</span><span class="o">.</span><span class="n">nrm</span><span class="o">.</span><span class="n">residual</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span> <span class="n">ff</span><span class="o">.</span><span class="n">nrm</span><span class="o">.</span><span class="n">residual</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">((</span><span class="n">ff</span><span class="o">.</span><span class="n">nrm</span><span class="o">.</span><span class="n">residual</span><span class="o">/</span><span class="n">ff</span><span class="o">.</span><span class="n">datapeak</span><span class="p">)[</span><span class="n">tlo</span><span class="p">:</span><span class="n">thi</span><span class="p">,</span> <span class="n">tlo</span><span class="p">:</span><span class="n">thi</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Normalized residuals max and min: </span><span class="si">{:.2e}</span><span class="s2">, </span><span class="si">{:.2e}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ff</span><span class="o">.</span><span class="n">nrm</span><span class="o">.</span><span class="n">residual</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">/</span> <span class="n">ff</span><span class="o">.</span><span class="n">datapeak</span><span class="p">,</span>
                                                                     <span class="n">ff</span><span class="o">.</span><span class="n">nrm</span><span class="o">.</span><span class="n">residual</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">/</span> <span class="n">ff</span><span class="o">.</span><span class="n">datapeak</span><span class="p">))</span>
    <span class="n">utils</span><span class="o">.</span><span class="n">default_printoptions</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">raw_observables</span><span class="p">(</span><span class="n">fitsfn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fitsimdir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">affine2d</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">psf_offset_find_rotation</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                    <span class="n">psf_offset_ff</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">rotsearch_d</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">set_pistons</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">oversample</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                    <span class="n">mnem</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="n">firstfew</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reduce calibrated data to fringe observables</span>

<span class="sd">        returns: affine2d (measured or input),</span>
<span class="sd">        psf_offset_find_rotation (input),</span>
<span class="sd">        psf_offset_ff (input or found),</span>
<span class="sd">        fringe pistons/r (found)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;raw_observables: input&quot;</span><span class="p">,</span> <span class="n">fitsimdir</span> <span class="o">+</span> <span class="n">fitsfn</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;raw_observables: oversample&quot;</span><span class="p">,</span> <span class="n">oversample</span><span class="p">)</span>

    <span class="n">fobj</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fitsimdir</span> <span class="o">+</span> <span class="n">fitsfn</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">fobj</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;FILTER&#39;</span><span class="p">])</span>
    <span class="n">niriss</span> <span class="o">=</span> <span class="n">InstrumentData</span><span class="o">.</span><span class="n">NIRISS</span><span class="p">(</span><span class="n">fobj</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;FILTER&#39;</span><span class="p">],</span>
                                   <span class="n">bpexist</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                   <span class="n">firstfew</span><span class="o">=</span><span class="n">firstfew</span><span class="p">,</span><span class="c1"># read_data truncation to only read first few slices...</span>
                                   <span class="p">)</span>


    <span class="n">ff</span> <span class="o">=</span> <span class="n">nrm_core</span><span class="o">.</span><span class="n">FringeFitter</span><span class="p">(</span><span class="n">niriss</span><span class="p">,</span>
                               <span class="n">datadir</span><span class="o">=</span><span class="n">fitsimdir</span><span class="p">,</span>
                               <span class="n">savedir</span><span class="o">=</span><span class="n">fitsimdir</span><span class="p">,</span>
                               <span class="n">oversample</span><span class="o">=</span><span class="n">oversample</span><span class="p">,</span>
                               <span class="n">oifprefix</span><span class="o">=</span><span class="s2">&quot;ov</span><span class="si">{:d}</span><span class="s2">_&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">oversample</span><span class="p">)</span><span class="o">+</span><span class="n">mnem</span><span class="p">,</span>
                               <span class="n">interactive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                               <span class="n">save_txt_only</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">ff</span><span class="o">.</span><span class="n">fit_fringes</span><span class="p">(</span><span class="n">fitsimdir</span> <span class="o">+</span> <span class="n">fitsfn</span><span class="p">)</span>
    <span class="n">examine_observables</span><span class="p">(</span><span class="n">ff</span><span class="p">)</span>

    <span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">formatter</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;float&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{:+.2e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)},</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;raw_observables: fringepistons/rad&quot;</span><span class="p">,</span> <span class="n">ff</span><span class="o">.</span><span class="n">nrm</span><span class="o">.</span><span class="n">fringepistons</span><span class="p">)</span>
    <span class="n">utils</span><span class="o">.</span><span class="n">default_printoptions</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">affine2d</span><span class="p">,</span> <span class="n">psf_offset_find_rotation</span><span class="p">,</span> <span class="n">ff</span><span class="o">.</span><span class="n">nrm</span><span class="o">.</span><span class="n">psf_offset</span><span class="p">,</span> <span class="n">ff</span><span class="o">.</span><span class="n">nrm</span><span class="o">.</span><span class="n">fringepistons</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">fitsimdir</span><span class="p">,</span> <span class="n">ifn</span><span class="p">,</span> <span class="n">oversample</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">mnem</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">firstfew</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    fitsimdir: string: dir containing data file</span>
<span class="sd">    ifn: str inout file name</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">formatter</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;float&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{:+.2e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)},</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;main: &quot;</span><span class="p">,</span> <span class="n">ifn</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;main: fitsimdir&quot;</span><span class="p">,</span> <span class="n">fitsimdir</span><span class="p">)</span>

    <span class="n">aff</span><span class="p">,</span> <span class="n">psf_offset_r</span><span class="p">,</span> <span class="n">psf_offset_ff</span><span class="p">,</span> <span class="n">fringepistons</span> <span class="o">=</span> <span class="n">raw_observables</span><span class="p">(</span><span class="n">ifn</span><span class="p">,</span> <span class="n">fitsimdir</span><span class="p">,</span>
                                                                      <span class="n">oversample</span><span class="o">=</span><span class="n">oversample</span><span class="p">,</span>
                                                                      <span class="n">mnem</span><span class="o">=</span><span class="n">mnem</span><span class="p">,</span>
                                                                      <span class="n">firstfew</span><span class="o">=</span><span class="n">firstfew</span><span class="p">,</span>
                                                                      <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;aff&#39;</span><span class="p">,</span> <span class="n">aff</span><span class="p">,</span> <span class="s1">&#39;psf_offset_r&#39;</span><span class="p">,</span> <span class="n">psf_offset_r</span><span class="p">,</span> <span class="s1">&#39;psf_offset_ff&#39;</span><span class="p">,</span> <span class="n">psf_offset_ff</span><span class="p">,</span> <span class="s1">&#39;fringepistons&#39;</span><span class="p">,</span> <span class="n">fringepistons</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">aff</span>
    <span class="k">del</span> <span class="n">psf_offset_r</span>
    <span class="k">del</span> <span class="n">psf_offset_ff</span>
    <span class="k">del</span> <span class="n">fringepistons</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="run-implaneia">
<h3>Run ImPlaneIA<a class="headerlink" href="#run-implaneia" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mirdatafiles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;jw01093001001_01101_00001_nis_calints.fits&#39;</span><span class="p">,</span>
                <span class="s1">&#39;jw01093002001_01101_00001_nis_calints.fits&#39;</span><span class="p">,</span>
               <span class="p">]</span>

<span class="c1"># Choose FIRSTFEW = None to analyze all integrations</span>
<span class="n">FIRSTFEW</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">OVERSAMPLE</span> <span class="o">=</span> <span class="mi">7</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;FIRSTFEW&#39;</span><span class="p">,</span> <span class="n">FIRSTFEW</span><span class="p">,</span> <span class="s1">&#39;OVERSAMPLE&#39;</span><span class="p">,</span> <span class="n">OVERSAMPLE</span><span class="p">)</span>

<span class="n">datasuperdir</span> <span class="o">=</span> <span class="n">odir</span>

<span class="n">COUNT</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">fnmir</span> <span class="ow">in</span> <span class="n">mirdatafiles</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Analyzing</span><span class="se">\n</span><span class="s1">   &#39;</span><span class="p">,</span> <span class="n">COUNT</span><span class="p">,</span> <span class="n">fnmir</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.fits&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="n">hdr</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getheader</span><span class="p">(</span><span class="n">datasuperdir</span> <span class="o">+</span> <span class="n">fnmir</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">hdr</span><span class="p">[</span><span class="s1">&#39;FILTER&#39;</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">hdr</span><span class="p">[</span><span class="s1">&#39;TARGNAME&#39;</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">hdr</span><span class="p">[</span><span class="s1">&#39;TARGPROP&#39;</span><span class="p">])</span>
    <span class="c1"># next line for convenient use in oifits writer which looks up target online</span>
    <span class="n">catname</span> <span class="o">=</span> <span class="n">hdr</span><span class="p">[</span><span class="s1">&#39;TARGPROP&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="c1"># for target lookup on-line, otherwise UNKNOWN used</span>
    <span class="n">fits</span><span class="o">.</span><span class="n">setval</span><span class="p">(</span><span class="n">datasuperdir</span> <span class="o">+</span> <span class="n">fnmir</span><span class="p">,</span> <span class="s1">&#39;TARGNAME&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">catname</span><span class="p">)</span>
    <span class="n">fits</span><span class="o">.</span><span class="n">setval</span><span class="p">(</span><span class="n">datasuperdir</span> <span class="o">+</span> <span class="n">fnmir</span><span class="p">,</span> <span class="s1">&#39;TARGPROP&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">catname</span><span class="p">)</span>
    <span class="n">main</span><span class="p">(</span><span class="n">fitsimdir</span><span class="o">=</span><span class="n">datasuperdir</span><span class="p">,</span>
         <span class="n">ifn</span><span class="o">=</span><span class="n">fnmir</span><span class="p">,</span>
         <span class="n">oversample</span><span class="o">=</span><span class="n">OVERSAMPLE</span><span class="p">,</span>
         <span class="n">mnem</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
         <span class="n">firstfew</span><span class="o">=</span><span class="n">FIRSTFEW</span><span class="p">,</span>
         <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">COUNT</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="examine-the-output-products">
<h3>Examine the output products<a class="headerlink" href="#examine-the-output-products" title="Permalink to this headline">¶</a></h3>
<p>Analytical model is created and interferometric observables are calculated for each integration of the data. The output products are stored in a folder that has rootname of the file, jw01093001001_01101_00001_nis_calints for AB-dor and jw01093001001_01101_00001_nis_calints foir HD37093.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># integration 0 (1st integration)</span>
<span class="n">results_int0</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">odir</span> <span class="o">+</span> <span class="s2">&quot;jw01093001001_01101_00001_nis_calints/*00*&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_int0</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="information-about-observables-calculated-from-the-1st-integration">
<h3>Information about observables calculated from the 1st integration<a class="headerlink" href="#information-about-observables-calculated-from-the-1st-integration" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">phases_00</span><span class="o">.</span><span class="n">txt</span><span class="p">:</span> <span class="mi">35</span> <span class="n">fringe</span> <span class="n">phases</span>
<span class="o">-</span> <span class="n">amplitudes_00</span><span class="o">.</span><span class="n">txt</span><span class="p">:</span> <span class="mi">21</span> <span class="n">fringe</span> <span class="n">amplitudes</span>
<span class="o">-</span> <span class="n">CPs_00</span><span class="o">.</span><span class="n">txt</span><span class="p">:</span> <span class="mi">35</span> <span class="n">closure</span> <span class="n">phases</span>
<span class="o">-</span> <span class="n">CAs_00</span><span class="o">.</span><span class="n">txt</span><span class="p">:</span> <span class="mi">35</span> <span class="n">closure</span> <span class="n">amplitudes</span>
<span class="o">-</span> <span class="n">fringepistons_00</span><span class="o">.</span><span class="n">txt</span><span class="p">:</span> <span class="mi">7</span> <span class="n">pistons</span> <span class="p">(</span><span class="n">optical</span> <span class="n">path</span> <span class="n">delays</span> <span class="n">between</span> <span class="n">mask</span> <span class="n">holes</span><span class="p">)</span>
<span class="o">-</span> <span class="n">solutions_00</span><span class="o">.</span><span class="n">txt</span><span class="p">:</span> <span class="mi">44</span> <span class="n">fringe</span> <span class="n">coefficients</span> <span class="n">of</span> <span class="n">terms</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">analytical</span> <span class="n">model</span>
<span class="o">-</span> <span class="n">modelsolution_00</span><span class="o">.</span><span class="n">fits</span><span class="p">:</span> <span class="n">analytical</span> <span class="n">model</span>
<span class="o">-</span> <span class="n">n_modelsolution_00</span><span class="o">.</span><span class="n">fits</span><span class="p">:</span> <span class="n">normalized</span> <span class="n">analytical</span> <span class="n">model</span>
<span class="o">-</span> <span class="n">residual_00</span><span class="o">.</span><span class="n">fits</span><span class="p">:</span> <span class="n">data</span> <span class="o">-</span> <span class="n">model</span>
<span class="o">-</span> <span class="n">n_residual_00</span><span class="o">.</span><span class="n">fits</span><span class="p">:</span> <span class="n">normalized</span> <span class="n">residual</span>

</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cropped_data</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">odir</span> <span class="o">+</span> <span class="s2">&quot;jw01093001001_01101_00001_nis_calints/centered_0.fits&quot;</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">odir</span> <span class="o">+</span> <span class="s2">&quot;jw01093001001_01101_00001_nis_calints/modelsolution_00.fits&quot;</span><span class="p">)</span>
<span class="n">residual</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">odir</span> <span class="o">+</span> <span class="s2">&quot;jw01093001001_01101_00001_nis_calints/residual_00.fits&quot;</span><span class="p">)</span>
<span class="n">n_residual</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">odir</span> <span class="o">+</span> <span class="s2">&quot;jw01093001001_01101_00001_nis_calints/n_residual_00.fits&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;AB-Dor cropped data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cropped_data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;AB-Dor analytical model&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;AB-Dor residual (data - model)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">residual</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;AB-Dor normalized residual&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">n_residual</span><span class="p">,</span> <span class="n">clim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.03</span><span class="p">,</span><span class="mf">0.03</span><span class="p">),</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="oifits-files-for-the-target-and-calibrator">
<h3>OIFITS files for the target and calibrator<a class="headerlink" href="#oifits-files-for-the-target-and-calibrator" title="Permalink to this headline">¶</a></h3>
<p>OIFITS is the standard data exchange format for Optical Interferometry.  It is based on the Flexible Image Transport System (FITS).  OIFITS files include data tables for storing interferometric observables, including squared visibilities and closure phases.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">odirfiles</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">odir</span> <span class="o">+</span> <span class="s2">&quot;*oifits&quot;</span><span class="p">)</span>
<span class="n">odirfiles</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="calibrate-the-closure-phases-and-fringe-amplitudes-of-target-with-the-closure-phases-and-fringe-amplitudes-of-the-calibrator">
<h3>Calibrate the closure phases and fringe amplitudes of target with the closure phases and fringe amplitudes of the calibrator.<a class="headerlink" href="#calibrate-the-closure-phases-and-fringe-amplitudes-of-target-with-the-closure-phases-and-fringe-amplitudes-of-the-calibrator" title="Permalink to this headline">¶</a></h3>
<p>This step is necessary to remove instrumental contribution to closure phases and fringe amplitudes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the target and calibrator OIFITS files</span>
<span class="n">targ_oifits</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">odir</span><span class="p">,</span> <span class="s1">&#39;*ABDOR*oifits&#39;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">cal_oifits</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">odir</span><span class="p">,</span> <span class="s1">&#39;*HD37093*oifits&#39;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Produce a single calibrated OIFITS file</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;************  Running calibrate ***************&quot;</span><span class="p">)</span>
<span class="n">calibrate_oifits</span><span class="p">(</span><span class="n">targ_oifits</span><span class="p">,</span> <span class="n">cal_oifits</span><span class="p">,</span> <span class="n">oifprefix</span><span class="o">=</span><span class="s1">&#39;calib_&#39;</span><span class="p">,</span> <span class="n">datadir</span><span class="o">=</span><span class="n">odir</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The output of calibrate is calibrated oifits file that will be used as an input to 3_niriss_ami_binary.ipynb.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="aditional-resources">
<h2>Aditional Resources<a class="headerlink" href="#aditional-resources" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://jwst-docs.stsci.edu/near-infrared-imager-and-slitless-spectrograph/niriss-observing-modes/niriss-aperture-masking-interferometry">JWST NIRISS AMI</a></p></li>
</ul>
</div>
<div class="section" id="about-this-notebook">
<h2>About this notebook<a class="headerlink" href="#about-this-notebook" title="Permalink to this headline">¶</a></h2>
<p><strong>Author:</strong> Deepashri Thatte, Anand Sivaramakrishnan, Rachel Cooper,
<strong>Updated On:</strong> 2020-12-18</p>
<hr class="docutils" />
<p><a class="reference external" href="#top">Top of Page</a>
<img style="float: right;" src="https://raw.githubusercontent.com/spacetelescope/notebooks/master/assets/stsci_pri_combo_mark_horizonal_white_bkgd.png" alt="Space Telescope Logo" width="200px"/></p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "spacetelescope/jdat_notebooks",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks/niriss_ami_binary"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="1_niriss_ami_binary.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">NIRISS AMI simulation of binary point source AB Dor and calibrator HD37093</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../soss-transit-spectroscopy/HAT-P-1b-PART3-data-analysis.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Analyzing the JWST Pipeline products of HAT-P-1b observations with NIRISS/SOSS</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By STScI<br/>
    
        &copy; Copyright 2022.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>