
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MIRI MRS Spectroscopy of a Late M Star 2 - Data Analysis and Visualization &#8212; STScI JDAT Notebooks</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/main.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="JWST Data Analysis" href="../MIRI_IFU_YSOs_in_the_LMC/isha_nayak_ysos_in_the_lmc.html" />
    <link rel="prev" title="MIRI MRS Spectroscopy of a Late M Star 1 - Running the Pipeline" href="JWST_Mstar_dataAnalysis_runpipeline.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-D46G4HKJY3"></script>
<script>
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){ dataLayer.push(arguments); }
                    gtag('js', new Date());
                    gtag('config', 'G-D46G4HKJY3');
                </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/stsci_logo2.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">STScI JDAT Notebooks</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../intro.html">
   James Webb Space Telescope Data Analysis Tool Notebooks
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Cross-Instrument
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../asdf_example/asdf_example.html">
   Example of Converting a FITS File to ASDF
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../background_estimation_imaging/Imaging%20Sky%20Background%20Estimation.html">
   Complex 2D Background
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../composite_model_fitting/specfit_demo_3.html">
   Draft: Advanced Composite spectral model fitting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../NIRSpec_MAST_Query/NIRSpec_MAST_Query.html">
   MAST Query
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../specviz_notebookGUI_interaction/specviz_notebook_gui_interaction_redshift.html">
   Specviz Simple Demo
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  MIRI
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="JWST_Mstar_dataAnalysis_runpipeline.html">
   MIRI MRS Spectroscopy of a Late M Star 1 - Running the Pipeline
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Data Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../MIRI_IFU_YSOs_in_the_LMC/isha_nayak_ysos_in_the_lmc.html">
   JWST Data Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../MIRI_LRS_spectral_extraction/miri_lrs_spectral_extraction.html">
   LRS Extraction
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  NIRCam
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../aperture_photometry/NIRCam_Aperture_Photometry_Example.html">
   Point Source Aperture Photometry
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../NIRCam_photometry/NIRCam%20multiband%20photometry.html">
   NIRCam Multiband Photometry
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../psf_photometry/NIRCam_PSF_Photometry_Example.html">
   PSF Photometry
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../NIRCam_PSF-matched_photometry/NIRCam_PSF_matched_multiband_photometry.html">
   NIRCam PSF-matched multiband photometry
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../preimaging/preimaging_02_calwebb.html">
   Preimaging - Calwebb
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../preimaging/preimaging_03_association.html">
   Creating simulated images of the JWST astrometric calibration field in the LMC
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  NIRISS
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../NIRISS_WFSS_postpipeline/00.%20Optimal%20extraction.html">
   Part 0: Optimal Extraction of NIRISS WFSS Spectrum
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../NIRISS_WFSS_postpipeline/01.%20Combine%20and%20normalize%201D%20spectra.html">
   Part 1: Combine One-Dimensional NIRISS WFSS Spectra
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../NIRISS_WFSS_postpipeline/02.%20Cross%20correlation%20template.html">
   Part 2: Cross Correlation to Determine Redshift of NIRISS WFSS Spectra
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../NIRISS_WFSS_postpipeline/03.%20Spatially%20resolved%20emission%20line%20map.html">
   Part 3: Spatially Resolved Emission Line Map of NIRISS WFSS Spectra
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../niriss_ami_binary/1_niriss_ami_binary.html">
   NIRISS AMI simulation of binary point source AB Dor and calibrator HD37093
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../niriss_ami_binary/2_niriss_ami_binary.html">
   AMI Binary Star Notebook 2
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../soss-transit-spectroscopy/HAT-P-1b-PART3-data-analysis.html">
   SOSS Transient Spectroscopy
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  NIRSpec
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../ifu_optimal/ifu_optimal.html">
   IFU Optimal Extraction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../optimal_extraction_dynamic/Spectral%20Extraction.html">
   NIRSpec MOS Optimal Spectral Extraction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../mos-spectroscopy/MOSspec_sv06_revised.html">
   MOS Spectroscopy of Extragalactic Field
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../transit_spectroscopy_notebook/Exoplanet_Transmission_Spectra_JWST.html">
   Extracting an Exoplanet Transmission Spectrum from NIRSpec BOTS Time Series Observations
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/notebooks/MRS_Mstar_analysis/JWST_Mstar_dataAnalysis_analysis.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/spacetelescope/jdat_notebooks/"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/spacetelescope/jdat_notebooks//issues/new?title=Issue%20on%20page%20%2Fnotebooks/MRS_Mstar_analysis/JWST_Mstar_dataAnalysis_analysis.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        
        
        <button type="button" class="btn btn-secondary topbarbtn"
            onclick="initThebeSBT()" title="Launch Thebe" data-toggle="tooltip" data-placement="left"><i
                class="fas fa-play"></i><span style="margin-left: .4em;">Live Code</span></button>
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#to-do">
   To Do:
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#import-packages">
   Import Packages
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#specviz-visualization-of-the-spectrumlist">
   Specviz Visualization of the SpectrumList
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#video-1">
   Video 1:
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#read-in-the-spectrumlist-12-unique-spectra">
     Read in the SpectrumList (12 unique spectra)
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#load-in-the-spectrum-list-from-above-note-only-the-first-spectrum-in-your-list-is-displayed-automatically-you-will-need-to-turn-on-the-remaining-spectra-in-the-data-drop-down-then-hit-the-home-button-in-the-toolbar-and-scale-our-plot-accordingly-to-see-the-other-spectra">
       Load in the spectrum list from above. Note, only the first spectrum in your list is displayed automatically. You will need to turn on the remaining spectra in the “DATA” drop-down, then hit the “Home” button in the toolbar, and scale our plot accordingly to see the other spectra.
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cubeviz-visualization">
   Cubeviz Visualization
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#video-2">
   Video 2:
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#developer-note-need-to-pick-a-different-unit-than-meters-https-jira-stsci-edu-browse-jdat-1792">
     Developer Note. Need to pick a different unit than meters. https://jira.stsci.edu/browse/JDAT-1792
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#video-3">
   Video 3:
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#developer-note-since-cubeviz-only-displays-a-single-cube-at-a-time-you-can-t-extract-a-full-spectrum-at-the-current-time-so-you-should-use-the-spectrum-defined-above-spec">
     Developer Note: Since Cubeviz only displays a single cube at a time, you can’t extract a full spectrum at the current time. So, you should use the spectrum defined above (‘spec’)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#make-a-1d-spectrum-object">
   Make a 1D spectrum object
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#visualize-for-analysis-the-single-spectrum1d-object-created-above-from-all-12-individual-spectra">
   Visualize for Analysis the Single Spectrum1D Object Created Above from All 12 Individual Spectra
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#developer-note-cannot-currently-open-a-spectrum1d-output-from-cubeviz-in-specviz-https-jira-stsci-edu-browse-jdat-1791">
     Developer Note: Cannot currently open a spectrum1d output from cubeviz in specviz.  https://jira.stsci.edu/browse/JDAT-1791
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#video-4">
   Video 4:
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-analysis">
   Data analysis
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fit-a-continuum-find-the-best-fitting-template-stellar-photosphere-model-or-blackbody">
     Fit a continuum - find the best-fitting template (stellar photosphere model or blackbody)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#developer-note-would-idealy-like-to-fit-the-photosphere-with-a-set-of-phoenix-models">
     Developer Note: Would idealy like to fit the photosphere with a set of Phoenix Models.
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#video-5">
   Video 5:
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#developer-note-at-this-point-the-12-extracted-1d-spectra-need-to-get-spliced-together-with-a-specialty-function-written-for-mrs">
     Developer Note: At this point, the 12 extracted 1D spectra need to get spliced together with a specialty function written for MRS.
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#now-have-the-dust-continuum-want-to-look-for-features-and-measure-their-properties">
     Now have the dust continuum want to look for features and measure their properties.
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#as-an-example-lets-focus-on-the-amorphous-silicate-10-micron-region">
       As an example lets focus on the amorphous silicate 10 micron region.
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#video-6">
   Video 6:
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#video7">
   Video7:
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#additional-resources">
   Additional Resources
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#about-this-notebook">
   About this notebook
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>MIRI MRS Spectroscopy of a Late M Star 2 - Data Analysis and Visualization</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#to-do">
   To Do:
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#import-packages">
   Import Packages
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#specviz-visualization-of-the-spectrumlist">
   Specviz Visualization of the SpectrumList
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#video-1">
   Video 1:
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#read-in-the-spectrumlist-12-unique-spectra">
     Read in the SpectrumList (12 unique spectra)
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#load-in-the-spectrum-list-from-above-note-only-the-first-spectrum-in-your-list-is-displayed-automatically-you-will-need-to-turn-on-the-remaining-spectra-in-the-data-drop-down-then-hit-the-home-button-in-the-toolbar-and-scale-our-plot-accordingly-to-see-the-other-spectra">
       Load in the spectrum list from above. Note, only the first spectrum in your list is displayed automatically. You will need to turn on the remaining spectra in the “DATA” drop-down, then hit the “Home” button in the toolbar, and scale our plot accordingly to see the other spectra.
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cubeviz-visualization">
   Cubeviz Visualization
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#video-2">
   Video 2:
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#developer-note-need-to-pick-a-different-unit-than-meters-https-jira-stsci-edu-browse-jdat-1792">
     Developer Note. Need to pick a different unit than meters. https://jira.stsci.edu/browse/JDAT-1792
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#video-3">
   Video 3:
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#developer-note-since-cubeviz-only-displays-a-single-cube-at-a-time-you-can-t-extract-a-full-spectrum-at-the-current-time-so-you-should-use-the-spectrum-defined-above-spec">
     Developer Note: Since Cubeviz only displays a single cube at a time, you can’t extract a full spectrum at the current time. So, you should use the spectrum defined above (‘spec’)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#make-a-1d-spectrum-object">
   Make a 1D spectrum object
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#visualize-for-analysis-the-single-spectrum1d-object-created-above-from-all-12-individual-spectra">
   Visualize for Analysis the Single Spectrum1D Object Created Above from All 12 Individual Spectra
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#developer-note-cannot-currently-open-a-spectrum1d-output-from-cubeviz-in-specviz-https-jira-stsci-edu-browse-jdat-1791">
     Developer Note: Cannot currently open a spectrum1d output from cubeviz in specviz.  https://jira.stsci.edu/browse/JDAT-1791
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#video-4">
   Video 4:
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-analysis">
   Data analysis
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fit-a-continuum-find-the-best-fitting-template-stellar-photosphere-model-or-blackbody">
     Fit a continuum - find the best-fitting template (stellar photosphere model or blackbody)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#developer-note-would-idealy-like-to-fit-the-photosphere-with-a-set-of-phoenix-models">
     Developer Note: Would idealy like to fit the photosphere with a set of Phoenix Models.
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#video-5">
   Video 5:
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#developer-note-at-this-point-the-12-extracted-1d-spectra-need-to-get-spliced-together-with-a-specialty-function-written-for-mrs">
     Developer Note: At this point, the 12 extracted 1D spectra need to get spliced together with a specialty function written for MRS.
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#now-have-the-dust-continuum-want-to-look-for-features-and-measure-their-properties">
     Now have the dust continuum want to look for features and measure their properties.
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#as-an-example-lets-focus-on-the-amorphous-silicate-10-micron-region">
       As an example lets focus on the amorphous silicate 10 micron region.
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#video-6">
   Video 6:
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#video7">
   Video7:
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#additional-resources">
   Additional Resources
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#about-this-notebook">
   About this notebook
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <p><a id="top"></a></p>
<div class="tex2jax_ignore mathjax_ignore section" id="miri-mrs-spectroscopy-of-a-late-m-star-2-data-analysis-and-visualization">
<h1>MIRI MRS Spectroscopy of a Late M Star 2 - Data Analysis and Visualization<a class="headerlink" href="#miri-mrs-spectroscopy-of-a-late-m-star-2-data-analysis-and-visualization" title="Permalink to this headline">¶</a></h1>
<p><strong>Use case:</strong> Extract spatial-spectral features from IFU cube and measure their attributes.<br>
<strong>Data:</strong> Simulated <a class="reference external" href="https://jwst-docs.stsci.edu/mid-infrared-instrument/miri-observing-modes/miri-medium-resolution-spectroscopy">MIRI MRS</a> spectrum of AGB star.<br>
<strong>Source of Simulations:</strong> <a class="reference external" href="https://www.stsci.edu/jwst/science-planning/proposal-planning-toolbox/mirisim">MIRISim</a><br>
<strong>Pipeline Version:</strong> <a class="reference external" href="https://jwst-docs.stsci.edu/jwst-data-reduction-pipeline">JWST Pipeline</a><br>
<strong>Tools:</strong> specutils, jwst, photutils, astropy, scipy.<br>
<strong>Cross-intrument:</strong> NIRSpec, MIRI.<br>
<strong>Documentation:</strong> This notebook is part of a STScI’s larger <a class="reference external" href="https://jwst-docs.stsci.edu/jwst-post-pipeline-data-analysis">post-pipeline Data Analysis Tools Ecosystem</a> and can be <a class="reference external" href="https://github.com/spacetelescope/dat_pyinthesky/tree/main/jdat_notebooks/MRS_Mstar_analysis">downloaded</a> directly from the <a class="reference external" href="https://github.com/spacetelescope/jdat_notebooks">JDAT Notebook Github directory</a>.<br>
<strong>Note</strong>: This notebook includes MIRI simulated data cubes obtained using MIRISim (<a class="reference external" href="https://wiki.miricle.org//bin/view/Public/MIRISim_Public">https://wiki.miricle.org//bin/view/Public/MIRISim_Public</a>)
and run through the JWST pipeline (<a class="reference external" href="https://jwst-pipeline.readthedocs.io/en/latest/">https://jwst-pipeline.readthedocs.io/en/latest/</a>) of
point sources with spectra representative of late M type stars.</p>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This notebook analyzes one star represented by a dusty SED corresponding to the ISO SWS spectrum of
W Per from Kraemer et al. (2002) and Sloan et al. (2003) to cover the MRS spectral range 5-28 microns.  Analysis of JWST spectral cubes requires extracting spatial-spectral features of interest and measuring their attributes.</p>
<p>This is the second notebook, which will perform data analysis using <code class="docutils literal notranslate"><span class="pre">specutils</span></code>.  Specifically, it will fit a model photosphere/blackbody to the spectra.  Then it will calculate the centroids, line integrated flux and equivalent width for each dust and molecular feature.</p>
<p><strong>This notebook utilizes reduced data created in the first notebook (JWST_Mstar_dataAnalysis_runpipeline.ipynb), although you don’t have to run that notebook to use this notebook. All data created in notebook number 1 are available for download within this noteobok.</strong></p>
</div>
<div class="section" id="to-do">
<h2>To Do:<a class="headerlink" href="#to-do" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Make function to extract spectra from datacube using a different means of extraction.</p></li>
<li><p>Replace blackbody fit to the photosphere part of the spectra with a stellar photosphere model.</p></li>
<li><p>Make sure errors have been propagated correctly in the caculation of centroids, line integrated flux and equivalent widths. (Science Author)</p></li>
<li><p>Make simple function within the <code class="docutils literal notranslate"><span class="pre">specutils</span></code> framework to fit a continium and measure centroids, line integrated flux and equivalent widths of broad solid state and molecular features.</p></li>
</ul>
</div>
<div class="section" id="import-packages">
<h2>Import Packages<a class="headerlink" href="#import-packages" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import useful python packages</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Import packages to display images inline in the notebook</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>    
<span class="o">%</span><span class="k">matplotlib</span> inline   

<span class="c1"># Set general plotting options</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;legend.fontsize&#39;</span><span class="p">:</span> <span class="s1">&#39;18&#39;</span><span class="p">,</span> <span class="s1">&#39;axes.labelsize&#39;</span><span class="p">:</span> <span class="s1">&#39;18&#39;</span><span class="p">,</span>
          <span class="s1">&#39;axes.titlesize&#39;</span><span class="p">:</span> <span class="s1">&#39;18&#39;</span><span class="p">,</span> <span class="s1">&#39;xtick.labelsize&#39;</span><span class="p">:</span> <span class="s1">&#39;18&#39;</span><span class="p">,</span>
          <span class="s1">&#39;ytick.labelsize&#39;</span><span class="p">:</span> <span class="s1">&#39;18&#39;</span><span class="p">,</span> <span class="s1">&#39;lines.linewidth&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;axes.linewidth&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;animation.html&#39;</span><span class="p">:</span> <span class="s1">&#39;html5&#39;</span><span class="p">}</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;figure.max_open_warning&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import astropy packages </span>
<span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">u</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">ascii</span>
<span class="kn">from</span> <span class="nn">astropy.wcs</span> <span class="kn">import</span> <span class="n">WCS</span>
<span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">Table</span><span class="p">,</span> <span class="n">vstack</span>
<span class="kn">from</span> <span class="nn">astropy.stats</span> <span class="kn">import</span> <span class="n">sigma_clipped_stats</span>
<span class="kn">from</span> <span class="nn">astropy.nddata</span> <span class="kn">import</span> <span class="n">StdDevUncertainty</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span> <span class="c1"># added by BAS on 8 April 2021</span>
<span class="kn">from</span> <span class="nn">astropy.utils.data</span> <span class="kn">import</span> <span class="n">get_pkg_data_filename</span>
<span class="kn">from</span> <span class="nn">astropy.utils.data</span> <span class="kn">import</span> <span class="n">download_file</span>

<span class="c1"># To find stars in the MRS spectralcubes and do aperture photometry</span>
<span class="kn">from</span> <span class="nn">photutils</span> <span class="kn">import</span> <span class="n">DAOStarFinder</span><span class="p">,</span> <span class="n">CircularAperture</span>

<span class="c1"># To deal with 1D spectrum</span>
<span class="kn">from</span> <span class="nn">specutils</span> <span class="kn">import</span> <span class="n">Spectrum1D</span>
<span class="kn">from</span> <span class="nn">specutils.fitting</span> <span class="kn">import</span> <span class="n">fit_generic_continuum</span>
<span class="kn">from</span> <span class="nn">specutils.manipulation</span> <span class="kn">import</span> <span class="n">box_smooth</span><span class="p">,</span> <span class="n">extract_region</span><span class="p">,</span> <span class="n">SplineInterpolatedResampler</span>
<span class="kn">from</span> <span class="nn">specutils.analysis</span> <span class="kn">import</span> <span class="n">line_flux</span><span class="p">,</span> <span class="n">centroid</span><span class="p">,</span> <span class="n">equivalent_width</span>
<span class="kn">from</span> <span class="nn">specutils.spectra</span> <span class="kn">import</span> <span class="n">SpectralRegion</span>
<span class="kn">from</span> <span class="nn">specutils</span> <span class="kn">import</span> <span class="n">SpectrumList</span>
<span class="kn">from</span> <span class="nn">jdaviz</span> <span class="kn">import</span> <span class="n">Specviz</span>
<span class="kn">from</span> <span class="nn">jdaviz</span> <span class="kn">import</span> <span class="n">Cubeviz</span>

<span class="c1"># To fit a curve to the data</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span>

<span class="c1"># Display the video</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">HTML</span><span class="p">,</span> <span class="n">YouTubeVideo</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Save and Load Objects Using Pickle</span>
<span class="kn">import</span> <span class="nn">pickle</span>


<span class="k">def</span> <span class="nf">save_obj</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span><span class="p">)</span>

        
<span class="k">def</span> <span class="nf">load_obj</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">checkKey</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
      
    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Present, &quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;value =&quot;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="k">return</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Not present&quot;</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check if Pipeline 3 Reduced data exists and, if not, download it</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">urllib.request</span>

<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;combine_dithers_all_exposures_ch1-long_s3d.fits&quot;</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Pipeline 3 Data Exists&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/reduced.tar.gz&#39;</span>
    <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s1">&#39;./reduced.tar.gz&#39;</span><span class="p">)</span>
    <span class="c1"># Unzip Tar Files</span>

    <span class="kn">import</span> <span class="nn">tarfile</span>

    <span class="c1"># Unzip files if they haven&#39;t already been unzipped</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;reduced/&quot;</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Pipeline 3 Data Exists&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;./reduced.tar.gz&#39;</span><span class="p">,</span> <span class="s2">&quot;r:gz&quot;</span><span class="p">)</span>
        <span class="n">tar</span><span class="o">.</span><span class="n">extractall</span><span class="p">()</span>
        <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        
    <span class="c1"># Move Files </span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;mv reduced/*fits .&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="nn">Input In [6],</span> in <span class="ni">&lt;cell line: 5&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>     <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/reduced.tar.gz&#39;</span>
<span class="ne">----&gt; </span><span class="mi">9</span>     <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s1">&#39;./reduced.tar.gz&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span>     <span class="c1"># Unzip Tar Files</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span>     <span class="kn">import</span> <span class="nn">tarfile</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/urllib/request.py:268,</span> in <span class="ni">urlretrieve</span><span class="nt">(url, filename, reporthook, data)</span>
<span class="g g-Whitespace">    </span><span class="mi">265</span>     <span class="n">reporthook</span><span class="p">(</span><span class="n">blocknum</span><span class="p">,</span> <span class="n">bs</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">267</span> <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">268</span>     <span class="n">block</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">bs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">269</span>     <span class="k">if</span> <span class="ow">not</span> <span class="n">block</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">270</span>         <span class="k">break</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/http/client.py:462,</span> in <span class="ni">HTTPResponse.read</span><span class="nt">(self, amt)</span>
<span class="g g-Whitespace">    </span><span class="mi">459</span> <span class="k">if</span> <span class="n">amt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">460</span>     <span class="c1"># Amount is given, implement using readinto</span>
<span class="g g-Whitespace">    </span><span class="mi">461</span>     <span class="n">b</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">amt</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">462</span>     <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readinto</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">463</span>     <span class="k">return</span> <span class="nb">memoryview</span><span class="p">(</span><span class="n">b</span><span class="p">)[:</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">464</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">465</span>     <span class="c1"># Amount is not given (unbounded read) so we must check self.length</span>
<span class="g g-Whitespace">    </span><span class="mi">466</span>     <span class="c1"># and self.chunked</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/http/client.py:506,</span> in <span class="ni">HTTPResponse.readinto</span><span class="nt">(self, b)</span>
<span class="g g-Whitespace">    </span><span class="mi">501</span>         <span class="n">b</span> <span class="o">=</span> <span class="nb">memoryview</span><span class="p">(</span><span class="n">b</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">503</span> <span class="c1"># we do not use _safe_read() here because this may be a .will_close</span>
<span class="g g-Whitespace">    </span><span class="mi">504</span> <span class="c1"># connection, and the user is reading more bytes than will be provided</span>
<span class="g g-Whitespace">    </span><span class="mi">505</span> <span class="c1"># (for example, reading in 1k chunks)</span>
<span class="ne">--&gt; </span><span class="mi">506</span> <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fp</span><span class="o">.</span><span class="n">readinto</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">507</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span> <span class="ow">and</span> <span class="n">b</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">508</span>     <span class="c1"># Ideally, we would raise IncompleteRead if the content-length</span>
<span class="g g-Whitespace">    </span><span class="mi">509</span>     <span class="c1"># wasn&#39;t satisfied, but it might break compatibility.</span>
<span class="g g-Whitespace">    </span><span class="mi">510</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_close_conn</span><span class="p">()</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/socket.py:704,</span> in <span class="ni">SocketIO.readinto</span><span class="nt">(self, b)</span>
<span class="g g-Whitespace">    </span><span class="mi">702</span> <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">703</span>     <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">704</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sock</span><span class="o">.</span><span class="n">recv_into</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">705</span>     <span class="k">except</span> <span class="n">timeout</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">706</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_timeout_occurred</span> <span class="o">=</span> <span class="kc">True</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/ssl.py:1241,</span> in <span class="ni">SSLSocket.recv_into</span><span class="nt">(self, buffer, nbytes, flags)</span>
<span class="g g-Whitespace">   </span><span class="mi">1237</span>     <span class="k">if</span> <span class="n">flags</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1238</span>         <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1239</span>           <span class="s2">&quot;non-zero flags not allowed in calls to recv_into() on </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
<span class="g g-Whitespace">   </span><span class="mi">1240</span>           <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">1241</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">nbytes</span><span class="p">,</span> <span class="n">buffer</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1242</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1243</span>     <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">recv_into</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">nbytes</span><span class="p">,</span> <span class="n">flags</span><span class="p">)</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/ssl.py:1099,</span> in <span class="ni">SSLSocket.read</span><span class="nt">(self, len, buffer)</span>
<span class="g g-Whitespace">   </span><span class="mi">1097</span> <span class="k">try</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1098</span>     <span class="k">if</span> <span class="n">buffer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1099</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sslobj</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">buffer</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1100</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1101</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sslobj</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="nb">len</span><span class="p">)</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
<p>Read in 12 spectra from Notebook 1 using <a class="reference external" href="https://specutils.readthedocs.io/en/stable/api/specutils.SpectrumList.html">SpectrumList</a> and create one master spectrum.
MIRI MRS data will typically have a separate 1D spectrum and 3D cube associated with each Channel and Sub-Band.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read in all X1D spectra to a single spectrum list and combine into a single spectrum1d object</span>

<span class="n">ddd</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span>
<span class="n">splist</span> <span class="o">=</span> <span class="n">SpectrumList</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">ddd</span><span class="p">)</span>

<span class="n">wlallorig</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">fnuallorig</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">dfnuallorig</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">bndind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">splist</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">wlind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">splist</span><span class="p">[</span><span class="n">bndind</span><span class="p">]</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">)):</span>
        <span class="n">wlallorig</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">splist</span><span class="p">[</span><span class="n">bndind</span><span class="p">]</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">[</span><span class="n">wlind</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">fnuallorig</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">splist</span><span class="p">[</span><span class="n">bndind</span><span class="p">]</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="n">wlind</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">dfnuallorig</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">splist</span><span class="p">[</span><span class="n">bndind</span><span class="p">]</span><span class="o">.</span><span class="n">uncertainty</span><span class="p">[</span><span class="n">wlind</span><span class="p">]</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>

<span class="n">wlallarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">wlallorig</span><span class="p">)</span>
<span class="n">fnuallarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fnuallorig</span><span class="p">)</span>
<span class="n">dfnuallarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dfnuallorig</span><span class="p">)</span>
<span class="n">srtind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">wlallarr</span><span class="p">)</span>
<span class="n">wlall</span> <span class="o">=</span> <span class="n">wlallarr</span><span class="p">[</span><span class="n">srtind</span><span class="p">]</span>
<span class="n">fnuall</span> <span class="o">=</span> <span class="n">fnuallarr</span><span class="p">[</span><span class="n">srtind</span><span class="p">]</span>

<span class="c1"># Developer Note: We put in errors of 0.0001, but uncertainties need to be fixed</span>
<span class="n">dfnuall</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0001</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fnuall</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="specviz-visualization-of-the-spectrumlist">
<h2>Specviz Visualization of the SpectrumList<a class="headerlink" href="#specviz-visualization-of-the-spectrumlist" title="Permalink to this headline">¶</a></h2>
<p>You can visualize the spectrum list inside a Jupyter notebook using Specviz</p>
</div>
<div class="section" id="video-1">
<h2>Video 1:<a class="headerlink" href="#video-1" title="Permalink to this headline">¶</a></h2>
<p>This Specviz Instructional Demo is from STScI’s official YouTube channel and provides an introduction to Cubeviz.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vid</span> <span class="o">=</span> <span class="n">YouTubeVideo</span><span class="p">(</span><span class="s2">&quot;zLyRnfG32Bo&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">vid</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="read-in-the-spectrumlist-12-unique-spectra">
<h3>Read in the SpectrumList (12 unique spectra)<a class="headerlink" href="#read-in-the-spectrumlist-12-unique-spectra" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Open these spectra up in Specviz</span>
<span class="n">specviz</span> <span class="o">=</span> <span class="n">Specviz</span><span class="p">()</span>
<span class="n">specviz</span><span class="o">.</span><span class="n">app</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="load-in-the-spectrum-list-from-above-note-only-the-first-spectrum-in-your-list-is-displayed-automatically-you-will-need-to-turn-on-the-remaining-spectra-in-the-data-drop-down-then-hit-the-home-button-in-the-toolbar-and-scale-our-plot-accordingly-to-see-the-other-spectra">
<h4>Load in the spectrum list from above. Note, only the first spectrum in your list is displayed automatically. You will need to turn on the remaining spectra in the “DATA” drop-down, then hit the “Home” button in the toolbar, and scale our plot accordingly to see the other spectra.<a class="headerlink" href="#load-in-the-spectrum-list-from-above-note-only-the-first-spectrum-in-your-list-is-displayed-automatically-you-will-need-to-turn-on-the-remaining-spectra-in-the-data-drop-down-then-hit-the-home-button-in-the-toolbar-and-scale-our-plot-accordingly-to-see-the-other-spectra" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load in the spectrum list from above. </span>
<span class="n">specviz</span><span class="o">.</span><span class="n">load_spectrum</span><span class="p">(</span><span class="n">splist</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="cubeviz-visualization">
<h2>Cubeviz Visualization<a class="headerlink" href="#cubeviz-visualization" title="Permalink to this headline">¶</a></h2>
<p>You can also visualize images inside a Jupyter notebook using Cubeviz</p>
</div>
<div class="section" id="video-2">
<h2>Video 2:<a class="headerlink" href="#video-2" title="Permalink to this headline">¶</a></h2>
<p>This Cubeviz Instructional Demo is from STScI’s official YouTube channel and provides an introduction to Cubeviz.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vid</span> <span class="o">=</span> <span class="n">YouTubeVideo</span><span class="p">(</span><span class="s2">&quot;HMSYwiH3Gl4&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">vid</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cubeviz</span> <span class="o">=</span> <span class="n">Cubeviz</span><span class="p">()</span>
<span class="n">cubeviz</span><span class="o">.</span><span class="n">app</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="developer-note-need-to-pick-a-different-unit-than-meters-https-jira-stsci-edu-browse-jdat-1792">
<h3>Developer Note. Need to pick a different unit than meters. <a class="reference external" href="https://jira.stsci.edu/browse/JDAT-1792">https://jira.stsci.edu/browse/JDAT-1792</a><a class="headerlink" href="#developer-note-need-to-pick-a-different-unit-than-meters-https-jira-stsci-edu-browse-jdat-1792" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Here, we load the data into the Cubeviz app for visual inspection.  </span>
<span class="c1"># In this case, we&#39;re just looking at a single channel because, unlike Specviz, Cubeviz can only load a single cube at a time.</span>

<span class="n">ch1short_cubefile</span> <span class="o">=</span> <span class="s1">&#39;combine_dithers_all_exposures_ch1-long_s3d.fits&#39;</span>
<span class="n">cubeviz</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">ch1short_cubefile</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Next, you want to define a pixel region subset that is specific to the AGB star.  You can do this with the regions utility button shown in the video below and drawing a circular region around the AGB star at approximate pixels x=20, y=30.</p>
</div>
</div>
<div class="section" id="video-3">
<h2>Video 3:<a class="headerlink" href="#video-3" title="Permalink to this headline">¶</a></h2>
<p>Here is a video that quickly shows how to select a spatial region in Cubeviz.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Video showing the selection of the star with a circular region of interest</span>
<span class="n">HTML</span><span class="p">(</span><span class="s1">&#39;&lt;iframe width=&quot;700&quot; height=&quot;500&quot; src=&quot;https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/region_select.mov&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now extract spectrum from your spectral viewer</span>
<span class="n">spec_agb</span> <span class="o">=</span> <span class="n">cubeviz</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">get_data_from_viewer</span><span class="p">(</span><span class="s1">&#39;spectrum-viewer&#39;</span><span class="p">,</span> <span class="s1">&#39;Subset 1&#39;</span><span class="p">)</span> <span class="c1"># AGB star only</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="developer-note-since-cubeviz-only-displays-a-single-cube-at-a-time-you-can-t-extract-a-full-spectrum-at-the-current-time-so-you-should-use-the-spectrum-defined-above-spec">
<h3>Developer Note: Since Cubeviz only displays a single cube at a time, you can’t extract a full spectrum at the current time. So, you should use the spectrum defined above (‘spec’)<a class="headerlink" href="#developer-note-since-cubeviz-only-displays-a-single-cube-at-a-time-you-can-t-extract-a-full-spectrum-at-the-current-time-so-you-should-use-the-spectrum-defined-above-spec" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="make-a-1d-spectrum-object">
<h2>Make a 1D spectrum object<a class="headerlink" href="#make-a-1d-spectrum-object" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wav</span> <span class="o">=</span> <span class="n">wlall</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">micron</span> <span class="c1"># Wavelength: microns</span>
<span class="n">fl</span> <span class="o">=</span> <span class="n">fnuall</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">Jy</span> <span class="c1"># Fnu:  Jy</span>
<span class="n">efl</span> <span class="o">=</span> <span class="n">dfnuall</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">Jy</span> <span class="c1"># Error flux: Jy</span>

<span class="c1"># Make a 1D spectrum object</span>
<span class="n">spec</span> <span class="o">=</span> <span class="n">Spectrum1D</span><span class="p">(</span><span class="n">spectral_axis</span><span class="o">=</span><span class="n">wav</span><span class="p">,</span> <span class="n">flux</span><span class="o">=</span><span class="n">fl</span><span class="p">,</span> <span class="n">uncertainty</span><span class="o">=</span><span class="n">StdDevUncertainty</span><span class="p">(</span><span class="n">efl</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Apply a 5 pixel boxcar smoothing to the spectrum</span>
<span class="n">spec_bsmooth</span> <span class="o">=</span> <span class="n">box_smooth</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>   

<span class="c1"># Plot the spectrum &amp; smoothed spectrum to inspect features </span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">,</span> <span class="n">spec</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Source&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">,</span> <span class="n">spec_bsmooth</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Smoothed&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength (microns)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Flux ({:latex})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">)</span>

<span class="c1"># Overplot the original input spectrum for comparison</span>
<span class="n">origspecfile</span> <span class="o">=</span> <span class="n">fn</span> <span class="o">=</span> <span class="n">download_file</span><span class="p">(</span><span class="s1">&#39;https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/63702662.txt&#39;</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">origdata</span> <span class="o">=</span> <span class="n">ascii</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">origspecfile</span><span class="p">)</span>
<span class="n">wlorig</span> <span class="o">=</span> <span class="n">origdata</span><span class="p">[</span><span class="s1">&#39;col1&#39;</span><span class="p">]</span>
<span class="n">fnujyorig</span> <span class="o">=</span> <span class="n">origdata</span><span class="p">[</span><span class="s1">&#39;col2&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">0.001</span> <span class="c1"># comes in as mJy, change to Jy to compare with pipeline output</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wlorig</span><span class="p">,</span> <span class="n">fnujyorig</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Original Input&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;medium&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spec_agb</span> <span class="o">=</span> <span class="n">spec</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="visualize-for-analysis-the-single-spectrum1d-object-created-above-from-all-12-individual-spectra">
<h2>Visualize for Analysis the Single Spectrum1D Object Created Above from All 12 Individual Spectra<a class="headerlink" href="#visualize-for-analysis-the-single-spectrum1d-object-created-above-from-all-12-individual-spectra" title="Permalink to this headline">¶</a></h2>
<p>You can visualize the extracted spectrum inside Specviz</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Open these spectra up in Specviz</span>
<span class="n">specviz</span> <span class="o">=</span> <span class="n">Specviz</span><span class="p">()</span>
<span class="n">specviz</span><span class="o">.</span><span class="n">app</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="developer-note-cannot-currently-open-a-spectrum1d-output-from-cubeviz-in-specviz-https-jira-stsci-edu-browse-jdat-1791">
<h3>Developer Note: Cannot currently open a spectrum1d output from cubeviz in specviz.  <a class="reference external" href="https://jira.stsci.edu/browse/JDAT-1791">https://jira.stsci.edu/browse/JDAT-1791</a><a class="headerlink" href="#developer-note-cannot-currently-open-a-spectrum1d-output-from-cubeviz-in-specviz-https-jira-stsci-edu-browse-jdat-1791" title="Permalink to this headline">¶</a></h3>
<p>#specviz.load_spectrum(spec_agb)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For now, you must create your own spectrum1d object from your extracted cubeviz spectrum.  </span>
<span class="n">flux</span> <span class="o">=</span> <span class="n">spec_agb</span><span class="o">.</span><span class="n">flux</span>
<span class="n">wavelength</span> <span class="o">=</span> <span class="n">spec_agb</span><span class="o">.</span><span class="n">spectral_axis</span>
<span class="n">spec1d</span> <span class="o">=</span> <span class="n">Spectrum1D</span><span class="p">(</span><span class="n">spectral_axis</span><span class="o">=</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">flux</span><span class="o">=</span><span class="n">flux</span><span class="p">)</span>
<span class="n">specviz</span><span class="o">.</span><span class="n">load_spectrum</span><span class="p">(</span><span class="n">spec1d</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="video-4">
<h2>Video 4:<a class="headerlink" href="#video-4" title="Permalink to this headline">¶</a></h2>
<p>Here is a video that quickly shows how to smooth your spectrum in Specviz.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Video showing how to smooth a spectrum in Specviz</span>
<span class="n">HTML</span><span class="p">(</span><span class="s1">&#39;&lt;iframe width=&quot;700&quot; height=&quot;500&quot; src=&quot;https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/smooth.mov&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="data-analysis">
<h2>Data analysis<a class="headerlink" href="#data-analysis" title="Permalink to this headline">¶</a></h2>
<p>Analyze the spectrum1d object (spec) created from the spectrumlist list above.</p>
<div class="section" id="fit-a-continuum-find-the-best-fitting-template-stellar-photosphere-model-or-blackbody">
<h3>Fit a continuum - find the best-fitting template (stellar photosphere model or blackbody)<a class="headerlink" href="#fit-a-continuum-find-the-best-fitting-template-stellar-photosphere-model-or-blackbody" title="Permalink to this headline">¶</a></h3>
<p>For AGB stars with a photosphere component fit a stellar photosphere model or a blackbody to short wavelength end of the spectra.</p>
</div>
<div class="section" id="developer-note-would-idealy-like-to-fit-the-photosphere-with-a-set-of-phoenix-models">
<h3>Developer Note: Would idealy like to fit the photosphere with a set of Phoenix Models.<a class="headerlink" href="#developer-note-would-idealy-like-to-fit-the-photosphere-with-a-set-of-phoenix-models" title="Permalink to this headline">¶</a></h3>
<p>I think <code class="docutils literal notranslate"><span class="pre">template_comparison</span></code> may be a good function here to work with the Phoenix Models which have been setup to
interface with <code class="docutils literal notranslate"><span class="pre">pysynphot</span></code>.<br>
For now switching to a blackbody.</p>
</div>
</div>
<div class="section" id="video-5">
<h2>Video 5:<a class="headerlink" href="#video-5" title="Permalink to this headline">¶</a></h2>
<p>Here is a video that shows how to fit a blackbody model to the spectrum</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Video showing how to fit a blackbody </span>
<span class="n">HTML</span><span class="p">(</span><span class="s1">&#39;&lt;iframe width=&quot;700&quot; height=&quot;500&quot; src=&quot;https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/blackbody_fit.mov&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spectra</span> <span class="o">=</span> <span class="n">specviz</span><span class="o">.</span><span class="n">get_spectra</span><span class="p">()</span>
   
<span class="n">a</span> <span class="o">=</span> <span class="n">checkKey</span><span class="p">(</span><span class="n">spectra</span><span class="p">,</span> <span class="s2">&quot;BB1&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
    <span class="c1"># Extract Blackbody fit from Specviz</span>
    <span class="n">blackbody</span> <span class="o">=</span> <span class="n">spectra</span><span class="p">[</span><span class="s2">&quot;BB1&quot;</span><span class="p">]</span>
<span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No Blackbody&quot;</span><span class="p">)</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="n">download_file</span><span class="p">(</span><span class="s1">&#39;https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/blackbody.fits&#39;</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">blackbody</span> <span class="o">=</span> <span class="n">Spectrum1D</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Delete any existing output in current directory</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;blackbody.fits&quot;</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;blackbody.fits&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The blackbody.fits file does not exist&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Save if you so desire. Keep commented otherwise.</span>
<span class="c1"># blackbody.write(&#39;blackbody.fits&#39;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Rename blackbody.flux as ybest</span>
<span class="n">ybest</span> <span class="o">=</span> <span class="n">blackbody</span><span class="o">.</span><span class="n">flux</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="developer-note-at-this-point-the-12-extracted-1d-spectra-need-to-get-spliced-together-with-a-specialty-function-written-for-mrs">
<h3>Developer Note: At this point, the 12 extracted 1D spectra need to get spliced together with a specialty function written for MRS.<a class="headerlink" href="#developer-note-at-this-point-the-12-extracted-1d-spectra-need-to-get-spliced-together-with-a-specialty-function-written-for-mrs" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the spectrum &amp; the model fit to the short wavelength region of the data.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">,</span> <span class="n">spec</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Source&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">,</span> <span class="n">ybest</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;BB&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength (microns)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Flux ({:latex})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Spectrum with blackbody fit&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;medium&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># Now subtract the BB and plot the underlying dust continuum</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">,</span> <span class="n">spec</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="n">ybest</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Dust spectra&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashdot&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength (microns)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Flux ({:latex})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Continuum-subtracted spectrum&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;medium&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="now-have-the-dust-continuum-want-to-look-for-features-and-measure-their-properties">
<h3>Now have the dust continuum want to look for features and measure their properties.<a class="headerlink" href="#now-have-the-dust-continuum-want-to-look-for-features-and-measure-their-properties" title="Permalink to this headline">¶</a></h3>
<p>Want to find:</p>
<ul class="simple">
<li><p>Equivalent width</p></li>
<li><p>Equivalent flux</p></li>
<li><p>Optical depth</p></li>
<li><p>Centroids = wavelength with half the flux on either side</p></li>
</ul>
<div class="section" id="as-an-example-lets-focus-on-the-amorphous-silicate-10-micron-region">
<h4>As an example lets focus on the amorphous silicate 10 micron region.<a class="headerlink" href="#as-an-example-lets-focus-on-the-amorphous-silicate-10-micron-region" title="Permalink to this headline">¶</a></h4>
<p><strong>Method - used repeatedly</strong></p>
<ul class="simple">
<li><p>Fit a spline to the photosphere continuum subtracted spectra excluding the feature in this fit.</p></li>
<li><p>Trim the spectra to that wavelength region as the spline is now a different size to the full wavelength range of the
spectra.</p></li>
<li><p>Make a continuum subtracted and and continuum normalised spectra.</p></li>
<li><p>Convert the units of the flux from Jy to W/m^2/wavelength for nice units post line integration.</p></li>
<li><p>Determine the feature line flux in units of W/m^2 and the feature centroid. Use continuum subtracted spectra.</p></li>
<li><p>Determine the feature equivalent width. Use continuum normalised spectra.</p></li>
<li><p>Make sure errors have been propagated correctly.</p></li>
<li><p>Store these results in a table</p></li>
<li><p>Several molecular and dust features are normally present in the spectra. Repeat for each feature.</p></li>
</ul>
<p><strong>Note</strong>
This seems like a long winded way to do this. Is there a simpler approach?</p>
<blockquote>
<div><p>For instance a tool that takes four wavelengths, fits a line using the data from  lam0 to lam1 and lam2 to lam3, then
passes the continuum-subtracted  spectrum for line integration from lam1 to lam2 with error propagation is needed
several times for dust features. But with the current spectra1d framework this takes many steps to write manually and
is beyond tedious after doing this for 2 features let alone 20+.  Similar framework is also needed for the integrated
line centroid with uncertainty, and the extracted equivalent width.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Subtract the continuum and plot in a new instance of specviz</span>
<span class="n">bbsub_spectra</span> <span class="o">=</span> <span class="n">spec</span> <span class="o">-</span> <span class="n">ybest</span><span class="o">.</span><span class="n">value</span>     <span class="c1"># continuum subtracted spectra - Dust only</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">specviz</span> <span class="o">=</span> <span class="n">Specviz</span><span class="p">()</span>
<span class="n">specviz</span><span class="o">.</span><span class="n">app</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">specviz</span><span class="o">.</span><span class="n">load_spectrum</span><span class="p">(</span><span class="n">bbsub_spectra</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="video-6">
<h2>Video 6:<a class="headerlink" href="#video-6" title="Permalink to this headline">¶</a></h2>
<p>Here is a video that shows how to fit a polynomial to two separate spectral regions within a single subset to remove more underlying continuum</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Video showing how to fit a polynomial to two separate spectral regions within a single subset</span>
<span class="n">HTML</span><span class="p">(</span><span class="s1">&#39;&lt;iframe width=&quot;700&quot; height=&quot;500&quot; src=&quot;https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/poly_fit.mov&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spectra</span> <span class="o">=</span> <span class="n">specviz</span><span class="o">.</span><span class="n">get_spectra</span><span class="p">()</span>
   
<span class="n">a</span> <span class="o">=</span> <span class="n">checkKey</span><span class="p">(</span><span class="n">spectra</span><span class="p">,</span> <span class="s2">&quot;PolyFit&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
    <span class="c1"># Extract Blackbody fit from Specviz</span>
    <span class="n">blackbody</span> <span class="o">=</span> <span class="n">spectra</span><span class="p">[</span><span class="s2">&quot;PolyFit&quot;</span><span class="p">]</span>
<span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No Polyfit&quot;</span><span class="p">)</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="n">download_file</span><span class="p">(</span><span class="s1">&#39;https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/poly.fits&#39;</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">poly</span> <span class="o">=</span> <span class="n">Spectrum1D</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Delete any existing output in current directory</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;poly.fits&quot;</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;poly.fits&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The poly.fits file does not exist&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Save if you so desire. Keep commented otherwise.</span>
<span class="c1"># poly.write(&#39;poly.fits&#39;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fit a local continuum between the flux densities at: 8.0 - 8.1 &amp; 14.9 - 15.0 microns</span>
<span class="c1"># (i.e. excluding the line itself)</span>

<span class="n">sw_region</span> <span class="o">=</span> <span class="mf">8.0</span>   <span class="c1"># lam0</span>
<span class="n">sw_line</span> <span class="o">=</span> <span class="mf">8.1</span>     <span class="c1"># lam1</span>
<span class="n">lw_line</span> <span class="o">=</span> <span class="mf">14.9</span>    <span class="c1"># lam2</span>
<span class="n">lw_region</span> <span class="o">=</span> <span class="mf">15.0</span>  <span class="c1"># lam3</span>

<span class="c1"># Zoom in on the line complex &amp; extract</span>
<span class="n">line_reg_10</span> <span class="o">=</span> <span class="n">SpectralRegion</span><span class="p">([(</span><span class="n">sw_region</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">,</span> <span class="n">lw_region</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">)])</span>
<span class="n">line_spec</span> <span class="o">=</span> <span class="n">extract_region</span><span class="p">(</span><span class="n">bbsub_spectra</span><span class="p">,</span> <span class="n">line_reg_10</span><span class="p">)</span>
<span class="n">polysub</span> <span class="o">=</span> <span class="n">extract_region</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="n">line_reg_10</span><span class="p">)</span>
<span class="n">line_y_continuum</span> <span class="o">=</span> <span class="n">polysub</span><span class="o">.</span><span class="n">flux</span>

<span class="c1"># -----------------------------------------------------------------</span>
<span class="c1"># Generate a continuum subtracted and continuum normalised spectra</span>

<span class="n">line_spec_norm</span> <span class="o">=</span> <span class="n">Spectrum1D</span><span class="p">(</span><span class="n">spectral_axis</span><span class="o">=</span><span class="n">line_spec</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">,</span> <span class="n">flux</span><span class="o">=</span><span class="n">line_spec</span><span class="o">.</span><span class="n">flux</span><span class="o">/</span><span class="n">line_y_continuum</span><span class="p">,</span> <span class="n">uncertainty</span><span class="o">=</span><span class="n">StdDevUncertainty</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">line_spec</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">))))</span>
<span class="n">line_spec_consub</span> <span class="o">=</span> <span class="n">Spectrum1D</span><span class="p">(</span><span class="n">spectral_axis</span><span class="o">=</span><span class="n">line_spec</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">,</span> <span class="n">flux</span><span class="o">=</span><span class="n">line_spec</span><span class="o">.</span><span class="n">flux</span> <span class="o">-</span> <span class="n">line_y_continuum</span><span class="p">,</span> <span class="n">uncertainty</span><span class="o">=</span><span class="n">StdDevUncertainty</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">line_spec</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">))))</span>

<span class="c1"># -----------------------------------------------------------------</span>
<span class="c1"># Plot the dust feature &amp; continuum fit to the region</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">line_spec</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">,</span> <span class="n">line_spec</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
         <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Dust spectra 10 micron region&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">line_spec</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">,</span> <span class="n">line_y_continuum</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Local continuum&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength (microns)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Flux ({:latex})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;10$\mu$m feature plus local continuum&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;medium&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># -----------------------------------------------------------------</span>
<span class="c1"># Plot the continuum subtracted 10 micron feature</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">line_spec</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">,</span> <span class="n">line_spec_consub</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span>
         <span class="n">label</span><span class="o">=</span><span class="s1">&#39;continuum subtracted&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength (microns)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Flux ({:latex})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Continuum subtracted 10$\mu$m feature&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load 10 um feature back into specviz and calculate the Line flux; Line Centroid; Equivalent width</span>
<span class="n">specviz</span> <span class="o">=</span> <span class="n">Specviz</span><span class="p">()</span>
<span class="n">specviz</span><span class="o">.</span><span class="n">app</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">specviz</span><span class="o">.</span><span class="n">load_spectrum</span><span class="p">(</span><span class="n">line_spec_consub</span><span class="p">,</span> <span class="n">data_label</span><span class="o">=</span><span class="s1">&#39;Continuum Subtraction&#39;</span><span class="p">)</span>
<span class="n">specviz</span><span class="o">.</span><span class="n">load_spectrum</span><span class="p">(</span><span class="n">line_spec_norm</span><span class="p">,</span> <span class="n">data_label</span><span class="o">=</span><span class="s1">&#39;Normalized&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="video7">
<h2>Video7:<a class="headerlink" href="#video7" title="Permalink to this headline">¶</a></h2>
<p>Here is a video that shows how to make line analysis measurements within specviz (i.e., line flux, line centroid, equivalent width)<br>
Note: You want to calculate your equivalent width on the normalized spectrum<br>
Note: You can also hack to convert the line flux value into more conventional units<br></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Video showing how to measure lines within specviz</span>
<span class="n">HTML</span><span class="p">(</span><span class="s1">&#39;&lt;iframe width=&quot;700&quot; height=&quot;500&quot; src=&quot;https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/line_analysis_plugin.mov&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Alternative method to analyze the 10um line within the notebook. Calculate the Line flux; Line Centroid; Equivalent width</span>

<span class="n">line_centroid</span> <span class="o">=</span> <span class="n">centroid</span><span class="p">(</span><span class="n">line_spec_consub</span><span class="p">,</span> <span class="n">SpectralRegion</span><span class="p">(</span><span class="n">sw_line</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">,</span> <span class="n">lw_line</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">))</span>
<span class="n">line_flux_val</span> <span class="o">=</span> <span class="n">line_flux</span><span class="p">(</span><span class="n">line_spec_consub</span><span class="p">,</span> <span class="n">SpectralRegion</span><span class="p">(</span><span class="n">sw_line</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">,</span> <span class="n">lw_line</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">))</span>

<span class="n">equivalent_width_val</span> <span class="o">=</span> <span class="n">equivalent_width</span><span class="p">(</span><span class="n">line_spec_norm</span><span class="p">)</span>

<span class="c1"># Hack to convert the line flux value into more conventional units</span>
<span class="c1"># Necessary as spectra has mixed units: f_nu+lambda</span>
<span class="n">line_flux_val</span> <span class="o">=</span> <span class="p">(</span><span class="n">line_flux_val</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">micron</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">W</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">m</span><span class="o">**-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">micron</span><span class="p">,</span>
                                              <span class="n">u</span><span class="o">.</span><span class="n">spectral_density</span><span class="p">(</span><span class="n">line_centroid</span><span class="p">))</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">micron</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Line_centroid: </span><span class="si">{:.6}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line_centroid</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Integrated line_flux: </span><span class="si">{:.6}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line_flux_val</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Equivalent width: </span><span class="si">{:.6}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">equivalent_width_val</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute the optical depth of the 10 micron feature</span>

<span class="n">tau</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">line_spec</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="n">line_y_continuum</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
<span class="n">optdepth_spec</span> <span class="o">=</span> <span class="n">Spectrum1D</span><span class="p">(</span><span class="n">spectral_axis</span><span class="o">=</span><span class="n">line_spec</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">,</span>
                           <span class="n">flux</span><span class="o">=</span><span class="n">tau</span><span class="o">*</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">Jy</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">Jy</span><span class="p">))</span>
        
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the optical depth of the 10 micron region vs wavelength</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">optdepth_spec</span><span class="o">.</span><span class="n">spectral_axis</span><span class="p">,</span> <span class="n">optdepth_spec</span><span class="o">.</span><span class="n">flux</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Wavelength ({:latex})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">spectral_axis</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Tau&#39;</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Note</strong> At this point repeat <em>all</em> the steps above to isolate solid-state features e.g. for the forsterite feature at
at approx 13.3 microns.</p>
<p>This is the end of the notebook that shows some basic analysis of a MIRI MRS spectrum using Cubeviz and Specviz.  Much more analysis is possible.</p>
</div>
<div class="section" id="additional-resources">
<h2>Additional Resources<a class="headerlink" href="#additional-resources" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://gitlab.gwdg.de/skamann/pampelmuse">PampelMuse</a></p></li>
<li><p><a class="reference external" href="https://casa.nrao.edu/Release3.4.0/docs/UserMan/UserManse41.html">CASA</a></p></li>
</ul>
</div>
<div class="section" id="about-this-notebook">
<h2>About this notebook<a class="headerlink" href="#about-this-notebook" title="Permalink to this headline">¶</a></h2>
<p><strong>Author:</strong> Olivia Jones, Project Scientist, UK ATC.<br>
<strong>Updated On:</strong> 2020-08-11<br>
<strong>Updated On:</strong> 2021-09-06 by B. Sargent, STScI Scientist, Space Telescope Science Institute (added MRS Simulated Data)<br>
<strong>Updated On:</strong> 2021-12-12 by O. Fox, STScI Scientist (added blackbody and polynomial fitting within the notebook)<br></p>
<hr class="docutils" />
<p><a class="reference external" href="#top">Top of Page</a></p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "spacetelescope/jdat_notebooks",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks/MRS_Mstar_analysis"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="JWST_Mstar_dataAnalysis_runpipeline.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">MIRI MRS Spectroscopy of a Late M Star 1 - Running the Pipeline</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../MIRI_IFU_YSOs_in_the_LMC/isha_nayak_ysos_in_the_lmc.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">JWST Data Analysis</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By STScI<br/>
    
        &copy; Copyright 2022.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>